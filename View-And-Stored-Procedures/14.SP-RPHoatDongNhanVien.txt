CREATE PROCEDURE [dbo].[sp_HoatDongNhanVien]
@MANV int,
@LOAI nvarchar(4),
@DATEFROM DATETIME,
@DATETO DATETIME
AS
BEGIN
	IF( @LOAI = 'NHAP')
	BEGIN
		SELECT FORMAT(PN.NGAY,'MM-yyyy') AS THANGNAM,
				PN.NGAY, 
				PN.MAPN AS MAPHIEU,
				N'Nhập' AS LOAIPHIEU,
				TENVT, 
				TENKHO, 
				SOLUONG,
				DONGIA
		FROM (SELECT NGAY, 
					MAPN,
					TENKHO = ( SELECT TENKHO FROM Kho WHERE P.MAKHO = Kho.MAKHO )
				FROM PhieuNhap AS P
				WHERE NGAY BETWEEN @DATEFROM AND @DATETO 
				AND MANV = @MANV )PN,
				CTPN,
				(SELECT MAVT, TENVT FROM Vattu ) VT
		WHERE PN.MAPN =CTPN.MAPN
		AND VT.MAVT = CTPN.MAVT
		ORDER BY NGAY, MAPHIEU, TENVT
	END

	ELSE
	BEGIN
		SELECT FORMAT(PX.NGAY,'MM-yyyy') AS THANGNAM,
				PX.NGAY, 
				PX.MAPX AS MAPHIEU,
				N'Xuất' AS LOAIPHIEU,
				HOTENKH,
				TENVT, 
				TENKHO, 
				SOLUONG,
				DONGIA
		FROM (SELECT NGAY, 
					MAPX,
					P.HOTENKH,
					TENKHO = ( SELECT TENKHO FROM Kho WHERE P.MAKHO = Kho.MAKHO )
				
				FROM PhieuXuat AS P
				WHERE NGAY BETWEEN @DATEFROM AND @DATETO 
				AND MANV = @MANV )PX,
				CTPX,
				(SELECT MAVT, TENVT FROM Vattu ) VT
		WHERE PX.MAPX =CTPX.MAPX
		AND VT.MAVT = CTPX.MAVT
		
		ORDER BY NGAY, MAPHIEU, TENVT
	END
END