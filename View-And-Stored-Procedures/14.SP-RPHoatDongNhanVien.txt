CREATE PROCEDURE [dbo].[sp_HoatDongNhanVien]
@MANV int,
@LOAI nvarchar(4),
@DATEFROM DATETIME,
@DATETO DATETIME
AS
BEGIN
	IF( @LOAI = 'NHAP')
	BEGIN
		SELECT FORMAT(PN.NGAY,'MM-yyyy') AS THANGNAM, -- Group theo mẫu
				PN.NGAY, 
				PN.MAPN AS MAPHIEU,
				@LOAI AS LOAIPHIEU,
				(null) AS HOTENKH,
				TENVT, 
				SOLUONG,
				DONGIA
		FROM (SELECT NGAY, 
					MAPN
				FROM PhieuNhap AS P
				WHERE NGAY BETWEEN @DATEFROM AND @DATETO 
				AND MANV = @MANV )PN,
				CTPN,
				(SELECT MAVT, TENVT FROM Vattu ) VT
		WHERE PN.MAPN =CTPN.MAPN
		AND VT.MAVT = CTPN.MAVT
		ORDER BY NGAY, MAPHIEU, TENVT
	END

	ELSE
	BEGIN
		SELECT FORMAT(PX.NGAY,'MM-yyyy') AS THANGNAM, -- Group theo mẫu
				PX.NGAY, 
				PX.MAPX AS MAPHIEU,
				@LOAI AS LOAIPHIEU,
				PX.HOTENKH,
				TENVT, 
				SOLUONG,
				DONGIA
		FROM (SELECT NGAY, 
					MAPX,
					HOTENKH
				FROM PhieuXuat AS P
				WHERE NGAY BETWEEN @DATEFROM AND @DATETO 
				AND MANV = @MANV )PX,
				CTPX,
				(SELECT MAVT, TENVT FROM Vattu ) VT
		WHERE PX.MAPX =CTPX.MAPX
		AND VT.MAVT = CTPX.MAVT
		ORDER BY NGAY, MAPHIEU, TENVT
	END
END