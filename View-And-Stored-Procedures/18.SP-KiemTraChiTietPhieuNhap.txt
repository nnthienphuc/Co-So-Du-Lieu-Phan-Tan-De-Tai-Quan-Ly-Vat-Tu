USE [QLVT_DATHANG]
GO
/****** Object:  StoredProcedure [dbo].[sp_KiemTraChiTietPhieuNhap]    Script Date: 24-Jun-24 8:52:36 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[sp_KiemTraChiTietPhieuNhap]
@MAPN NCHAR(10),
@MAVT NCHAR(10)
AS 
BEGIN
	-- lấy chỉ cột mã vật tư mà thôi
	-- kiểm tra mẫ vật tư ở phân mảnh hiện tại
	IF EXISTS(SELECT 1 
			  FROM CTPN AS CT  
			  WHERE CT.MAPN = @MAPN
			  AND CT.MAVT = @MAVT)
			RETURN 1; -- MAVT đang dùng ở phân mảnh hiện tại
	-- -- kiểm tra mẫ vật tư ở phân mảnh khác
	ELSE IF EXISTS(SELECT 1
				   FROM LINK1.QLVT_DATHANG.DBO.CTPN AS CT
				   WHERE CT.MAPN = @MAPN
					AND CT.MAVT = @MAVT)
			RETURN 1; -- MAVT đang dùng ở phân mảnh khác
	RETURN 0; -- Chưa tồn tại
END